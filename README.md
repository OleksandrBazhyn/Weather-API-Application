# Weather API App

## Опис

Сервіс для підписки на email-розсилку погоди для обраного міста (щодня або щогодини). Покритий тестами та зі спробою розгорнути на Render.

## Як запустити локально

1. Встановіть залежності:
   ```
   npm install
   ```
2. Створіть файл `.env` (див. приклад у репозиторії).
3. Запустіть міграції:
   ```
   npx knex migrate:latest
   ```
4. Запустіть сервер:
   ```
   npm run dev
   ```

## Як запустити через Docker

1. Впевніться, що у вас є Docker і Docker Compose.
2. Створіть файл `.env.docker` (див. приклад у репозиторії).
3. Запустіть:
   ```
   docker-compose up --build
   ```
4. API буде доступне на http://localhost:3000

## Основні ендпоінти

- `GET /api/weather?city={city}`  
  Отримати поточну погоду для міста (температура, вологість, опис).

- `POST /api/subscribe`  
  Підписка на розсилку.  
  Тіло запиту (JSON):
  ```json
  {
    "email": "your@email.com",
    "city": "Kyiv",
    "frequency": "daily" // або "hourly"
  }
  ```

- `GET /api/confirm/{token}`  
  Підтвердження підписки (посилання надходить на email).

- `GET /api/unsubscribe/{token}`  
  Відписка від розсилки (посилання є у кожному листі).

## Як працює email-розсилка

- Після підписки користувач отримує лист з посиланням для підтвердження.
- Після підтвердження підписки, листи з погодою надсилаються автоматично:
  - Щогодини — якщо обрано "hourly"
  - Щодня о 8:00 — якщо обрано "daily"
- У кожному листі є посилання для відписки.

## Тестування

- Для тестування email використовуйте [Mailtrap](https://mailtrap.io/).
- Для тестування API використовуйте Postman або curl.


## Міграції

Всі міграції знаходяться у папці `migrations/`.
